name: "Attachment: RDP Connection file"
description: |
  Recursively scans files and archives to detect RDP connection files.

  Coercing a target user into connecting to an attacker-owned RDP server can expose elements of their host and potentially lead to compromise.
references:
  - "https://www.blackhillsinfosec.com/rogue-rdp-revisiting-initial-access-methods/"
type: "rule"
severity: "medium"
authors:
  - twitter: "ajpc500"
source: |
  type.inbound
  and any(attachments, 
      any(beta.binexplode(.), 
          length(filter(.scan.strings.strings, ilike(.,
              "*desktopwidth*",
              "*desktopheight*",
              "*full address*",
              "*gatewayhostname*"
          ))) == 4 and
          length(.scan.url.urls) >= 1
      )
  )
tags:
  - "Suspicious attachment"
